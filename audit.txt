Funcionalidades Actuales del Proyecto
Lista exhaustiva de lo que hace el módulo, agrupada por componente. Todo probado con BD erp_tierp_db (tablas platillos, ingredientes, insumos, inventario, pedidos, etc.).
Backend (server.js, routes/pedidos.js, controllers/*, models/pedido.js)

Servidor Principal (Express + Socket.IO): Inicia en puerto 3000, sirve frontend (public/), maneja rutas API. Conexión a PostgreSQL con pool para escalabilidad.
Rutas API:

/api/negocios: Lista negocios desde BD.
/api/almacenes: Lista almacenes por negocio.
/api/menu: Obtiene platillos finales con stock positivo de insumos.
/api/auth/register: Registra usuarios con roles (admin, cajero).
/api/auth/login: Login con JWT.
/api/pedidos: Crea pedidos (validación, descuentos insumos, notificaciones, integraciones).
/api/analytics/ventas-diarias: Reportes de ventas diarias (auth admin).
/api/pagos/iniciar: Inicia pago (mock o WebPay).
/api/pagos/confirmar: Confirma pago (mock o WebPay).


Lógica de Pedidos:

Valida stock de platillos/insumos (via ingredientes).
Calcula IVA/utilidad desde platillos.
Descuento automático: Resta insumos de inventario, registra en movimientos_stock.
Notificaciones: Email (nodemailer), real-time (Socket.IO).
Integraciones: Fetch a facturación/contabilidad (no bloqueantes).


Seguridad: JWT con roles, middleware para rutas admin/cajero.

Frontend (index.html, app.js, dashboard.html, styles.css)

Menú Digital (index.html + app.js):

Dropdowns para seleccionar negocio/almacén.
Carga platillos finales dinámicamente (41 items en tu prueba).
Carrito: Agregar/eliminar, cantidades, total en enteros (formato CLP).
Formulario: Cliente, teléfono, dirección (delivery), tipo pedido.
Envío: Fetch a /api/pedidos, alerta éxito/error, redirige a pago.
Modal: Confirma pedido con ID.


Dashboard (dashboard.html): Muestra pedidos real-time (Socket.IO), para local/admin.
Estilos: CSS con variables (Tailwind-like), responsive.


Tablas: platillos (costos, utilidad), ingredientes (recetas), insumos (ingredientes), inventario (stock), movimientos_stock (auditoría), pedidos (ordenes con IVA/utilidad).
Datos de Prueba: 41 platillos, insumos con stock, recetas para descuentos.

{
  "dependencies": {
    "axios": "^1.7.2",                    // Para llamadas HTTP a WebPay (en pagosController.js)
    "bcrypt": "^5.1.1",                   // Para hash de contraseñas en autenticación
    "dotenv": "^16.4.5",                  // Para cargar variables de entorno desde .env
    "express": "^4.19.2",                 // Framework para el servidor y rutas API
    "jsonwebtoken": "^9.0.2",             // Para autenticación JWT
    "nodemailer": "^6.9.14",              // Para envío de notificaciones por email
    "pg": "^8.12.0",                      // Cliente PostgreSQL para conexión a la base de datos
    "socket.io": "^4.7.5",                // Para notificaciones en tiempo real
    "transbank-sdk": "^3.1.2"             // SDK de Transbank para WebPay (usado en pagosController.js)
  }
}

{
  "devDependencies": {
    "nodemon": "^3.1.4"                   // Para reinicio automático del servidor en desarrollo
  }
}

base de datos
"alertas_stock"	"id"	"integer"
"alertas_stock"	"id_insumo"	"integer"
"alertas_stock"	"id_almacen"	"integer"
"alertas_stock"	"nivel_minimo"	"numeric"
"alertas_stock"	"nivel_actual"	"numeric"
"alertas_stock"	"fecha_alerta"	"timestamp without time zone"
"almacenes"	"id"	"integer"
"almacenes"	"id_negocio"	"integer"
"almacenes"	"nombre"	"character varying"
"almacenes"	"direccion"	"text"
"almacenes"	"created_at"	"timestamp without time zone"
"asientos_contables"	"id"	"integer"
"asientos_contables"	"numero_asiento"	"character varying"
"asientos_contables"	"fecha_asiento"	"date"
"asientos_contables"	"descripcion"	"text"
"asientos_contables"	"referencia"	"character varying"
"asientos_contables"	"tipo_origen"	"character varying"
"asientos_contables"	"id_origen"	"integer"
"asientos_contables"	"id_negocio"	"integer"
"asientos_contables"	"id_periodo"	"integer"
"asientos_contables"	"id_centro_costo"	"integer"
"asientos_contables"	"total_debe"	"numeric"
"asientos_contables"	"total_haber"	"numeric"
"asientos_contables"	"estado"	"character varying"
"asientos_contables"	"fecha_confirmacion"	"timestamp without time zone"
"asientos_contables"	"usuario_creacion"	"character varying"
"asientos_contables"	"usuario_confirmacion"	"character varying"
"asientos_contables"	"observaciones"	"text"
"asientos_contables"	"created_at"	"timestamp without time zone"
"asientos_contables"	"updated_at"	"timestamp without time zone"
"centros_costo"	"id"	"integer"
"centros_costo"	"codigo"	"character varying"
"centros_costo"	"nombre"	"character varying"
"centros_costo"	"descripcion"	"text"
"centros_costo"	"id_negocio"	"integer"
"centros_costo"	"id_responsable"	"integer"
"centros_costo"	"activo"	"boolean"
"centros_costo"	"created_at"	"timestamp without time zone"
"configuracion_contable"	"id"	"integer"
"configuracion_contable"	"id_negocio"	"integer"
"configuracion_contable"	"moneda_base"	"character varying"
"configuracion_contable"	"decimales_moneda"	"integer"
"configuracion_contable"	"separador_miles"	"character varying"
"configuracion_contable"	"separador_decimales"	"character varying"
"configuracion_contable"	"cuenta_ventas_default"	"integer"
"configuracion_contable"	"cuenta_compras_default"	"integer"
"configuracion_contable"	"cuenta_inventario_default"	"integer"
"configuracion_contable"	"cuenta_costo_ventas_default"	"integer"
"configuracion_contable"	"cuenta_caja_default"	"integer"
"configuracion_contable"	"cuenta_clientes_default"	"integer"
"configuracion_contable"	"cuenta_proveedores_default"	"integer"
"configuracion_contable"	"inicio_año_fiscal"	"date"
"configuracion_contable"	"metodo_valoracion_inventario"	"character varying"
"configuracion_contable"	"formato_asiento"	"character varying"
"configuracion_contable"	"ultimo_numero_asiento"	"integer"
"configuracion_contable"	"mostrar_saldos_cero"	"boolean"
"configuracion_contable"	"niveles_plan_cuentas"	"integer"
"configuracion_contable"	"created_at"	"timestamp without time zone"
"configuracion_contable"	"updated_at"	"timestamp without time zone"
"cuentas_contables"	"id"	"integer"
"cuentas_contables"	"codigo"	"character varying"
"cuentas_contables"	"nombre"	"character varying"
"cuentas_contables"	"id_tipo_cuenta"	"integer"
"cuentas_contables"	"id_cuenta_padre"	"integer"
"cuentas_contables"	"nivel"	"integer"
"cuentas_contables"	"naturaleza"	"character varying"
"cuentas_contables"	"acepta_movimientos"	"boolean"
"cuentas_contables"	"id_negocio"	"integer"
"cuentas_contables"	"descripcion"	"text"
"cuentas_contables"	"activa"	"boolean"
"cuentas_contables"	"created_at"	"timestamp without time zone"
"cuentas_contables"	"updated_at"	"timestamp without time zone"
"dashboard_facturas"	"mes"	"timestamp with time zone"
"dashboard_facturas"	"total_facturas"	"bigint"
"dashboard_facturas"	"monto_total"	"numeric"
"dashboard_facturas"	"monto_dte_enviado"	"numeric"
"dashboard_facturas"	"facturas_dte"	"bigint"
"dashboard_facturas"	"monto_promedio"	"numeric"
"dashboard_facturas"	"proveedores_unicos"	"bigint"
"detalle_asientos"	"id"	"integer"
"detalle_asientos"	"id_asiento"	"integer"
"detalle_asientos"	"id_cuenta"	"integer"
"detalle_asientos"	"orden_linea"	"integer"
"detalle_asientos"	"descripcion"	"text"
"detalle_asientos"	"debe"	"numeric"
"detalle_asientos"	"haber"	"numeric"
"detalle_asientos"	"referencia_detalle"	"character varying"
"detalle_asientos"	"id_centro_costo"	"integer"
"detalle_asientos"	"created_at"	"timestamp without time zone"
"dte_folios"	"id"	"integer"
"dte_folios"	"tipo_dte"	"integer"
"dte_folios"	"folio_desde"	"integer"
"dte_folios"	"folio_hasta"	"integer"
"dte_folios"	"folio_actual"	"integer"
"dte_folios"	"fecha_autorizacion"	"date"
"dte_folios"	"codigo_autorizacion"	"character varying"
"dte_folios"	"xml_caf"	"text"
"dte_folios"	"estado"	"character varying"
"dte_folios"	"fecha_creacion"	"timestamp without time zone"
"dte_seguimiento"	"id"	"integer"
"dte_seguimiento"	"factura_id"	"integer"
"dte_seguimiento"	"tipo_dte"	"integer"
"dte_seguimiento"	"folio"	"character varying"
"dte_seguimiento"	"estado_sii"	"character varying"
"dte_seguimiento"	"glosa_sii"	"text"
"dte_seguimiento"	"track_id"	"character varying"
"dte_seguimiento"	"fecha_envio"	"timestamp without time zone"
"dte_seguimiento"	"fecha_respuesta_sii"	"timestamp without time zone"
"dte_seguimiento"	"xml_enviado"	"text"
"dte_seguimiento"	"xml_respuesta"	"text"
"dte_seguimiento"	"intentos_envio"	"integer"
"dte_seguimiento"	"fecha_creacion"	"timestamp without time zone"
"factura_asientos"	"id"	"integer"
"factura_asientos"	"factura_id"	"integer"
"factura_asientos"	"asiento_id"	"integer"
"factura_asientos"	"tipo_asiento"	"character varying"
"factura_asientos"	"monto"	"numeric"
"factura_asientos"	"fecha_asiento"	"date"
"factura_asientos"	"descripcion"	"text"
"factura_asientos"	"fecha_creacion"	"timestamp without time zone"
"factura_inventario"	"id"	"integer"
"factura_inventario"	"factura_id"	"integer"
"factura_inventario"	"producto_id"	"integer"
"factura_inventario"	"cantidad"	"numeric"
"factura_inventario"	"precio_unitario"	"numeric"
"factura_inventario"	"descuento"	"numeric"
"factura_inventario"	"fecha_creacion"	"timestamp without time zone"
"factura_items"	"id"	"integer"
"factura_items"	"factura_id"	"integer"
"factura_items"	"producto_insumo"	"character varying"
"factura_items"	"categoria"	"character varying"
"factura_items"	"unidad_medida"	"character varying"
"factura_items"	"cantidad"	"numeric"
"factura_items"	"precio_unitario"	"numeric"
"factura_items"	"valor_afecto"	"numeric"
"factura_items"	"valor_inafecto"	"numeric"
"factura_items"	"impuestos"	"numeric"
"factura_items"	"total"	"numeric"
"factura_items"	"producto_id"	"integer"
"facturas"	"id"	"integer"
"facturas"	"fecha_factura"	"date"
"facturas"	"serie"	"character varying"
"facturas"	"numero"	"character varying"
"facturas"	"ruc"	"character varying"
"facturas"	"proveedor"	"character varying"
"facturas"	"valor_afecto"	"numeric"
"facturas"	"valor_inafecto"	"numeric"
"facturas"	"impuestos"	"numeric"
"facturas"	"importe"	"numeric"
"facturas"	"moneda"	"character varying"
"facturas"	"archivo_original"	"character varying"
"facturas"	"estado"	"character varying"
"facturas"	"fecha_registro"	"timestamp without time zone"
"facturas"	"sucursal_id"	"integer"
"facturas"	"dte_folio"	"character varying"
"facturas"	"dte_tipo"	"integer"
"facturas"	"dte_fecha_envio"	"timestamp without time zone"
"facturas"	"dte_estado"	"character varying"
"facturas"	"dte_xml"	"text"
"facturas"	"dte_track_id"	"character varying"
"facturas"	"created_at"	"timestamp without time zone"
"ingredientes"	"id"	"integer"
"ingredientes"	"platillo_id"	"integer"
"ingredientes"	"id_insumo"	"integer"
"ingredientes"	"nombre"	"text"
"ingredientes"	"cantidad"	"numeric"
"ingredientes"	"unidad"	"text"
"ingredientes"	"precio_unitario"	"numeric"
"ingredientes"	"costo_total"	"numeric"
"insumos"	"id"	"integer"
"insumos"	"nombre"	"text"
"insumos"	"unidad_medida"	"text"
"integraciones_log"	"id"	"integer"
"integraciones_log"	"modulo_origen"	"character varying"
"integraciones_log"	"tipo_operacion"	"character varying"
"integraciones_log"	"id_registro_origen"	"integer"
"integraciones_log"	"id_asiento_generado"	"integer"
"integraciones_log"	"estado"	"character varying"
"integraciones_log"	"mensaje"	"text"
"integraciones_log"	"datos_origen"	"jsonb"
"integraciones_log"	"fecha_procesamiento"	"timestamp without time zone"
"inventario"	"id"	"integer"
"inventario"	"id_insumo"	"integer"
"inventario"	"id_almacen"	"integer"
"inventario"	"cantidad"	"numeric"
"movimientos_stock"	"id"	"integer"
"movimientos_stock"	"id_insumo"	"integer"
"movimientos_stock"	"id_almacen"	"integer"
"movimientos_stock"	"tipo"	"character varying"
"movimientos_stock"	"cantidad"	"numeric"
"movimientos_stock"	"referencia"	"text"
"movimientos_stock"	"fecha"	"timestamp without time zone"
"negocios"	"id"	"integer"
"negocios"	"nombre"	"character varying"
"negocios"	"direccion"	"text"
"negocios"	"telefono"	"character varying"
"negocios"	"created_at"	"timestamp without time zone"
"pedidos"	"id"	"integer"
"pedidos"	"id_negocio"	"integer"
"pedidos"	"cliente"	"character varying"
"pedidos"	"productos"	"jsonb"
"pedidos"	"total"	"numeric"
"pedidos"	"fecha"	"timestamp without time zone"
"pedidos"	"telefono"	"character varying"
"pedidos"	"direccion"	"text"
"pedidos"	"tipo_pedido"	"character varying"
"pedidos"	"estado_pago"	"character varying"
"pedidos"	"iva"	"numeric"
"pedidos"	"utilidad"	"numeric"
"periodos_contables"	"id"	"integer"
"periodos_contables"	"id_negocio"	"integer"
"periodos_contables"	"año"	"integer"
"periodos_contables"	"mes"	"integer"
"periodos_contables"	"fecha_inicio"	"date"
"periodos_contables"	"fecha_fin"	"date"
"periodos_contables"	"estado"	"character varying"
"periodos_contables"	"created_at"	"timestamp without time zone"
"platillos"	"id"	"integer"
"platillos"	"categoria"	"text"
"platillos"	"nombre"	"text"
"platillos"	"costo_neto"	"numeric"
"platillos"	"iva"	"numeric"
"platillos"	"costo_bruto"	"numeric"
"platillos"	"costo_trans"	"numeric"
"platillos"	"utilidad"	"numeric"
"platillos"	"valor_venta"	"numeric"
"saldos_contables"	"id"	"integer"
"saldos_contables"	"id_cuenta"	"integer"
"saldos_contables"	"id_negocio"	"integer"
"saldos_contables"	"año"	"integer"
"saldos_contables"	"mes"	"integer"
"saldos_contables"	"saldo_inicial_debe"	"numeric"
"saldos_contables"	"saldo_inicial_haber"	"numeric"
"saldos_contables"	"movimientos_debe"	"numeric"
"saldos_contables"	"movimientos_haber"	"numeric"
"saldos_contables"	"saldo_final_debe"	"numeric"
"saldos_contables"	"saldo_final_haber"	"numeric"
"saldos_contables"	"saldo_neto"	"numeric"
"saldos_contables"	"updated_at"	"timestamp without time zone"
"sii_configuracion"	"id"	"integer"
"sii_configuracion"	"rut_empresa"	"character varying"
"sii_configuracion"	"nombre_empresa"	"character varying"
"sii_configuracion"	"giro_empresa"	"character varying"
"sii_configuracion"	"actividad_economica"	"character varying"
"sii_configuracion"	"direccion"	"text"
"sii_configuracion"	"comuna"	"character varying"
"sii_configuracion"	"ciudad"	"character varying"
"sii_configuracion"	"telefono"	"character varying"
"sii_configuracion"	"email"	"character varying"
"sii_configuracion"	"ambiente"	"character varying"
"sii_configuracion"	"certificado_digital"	"text"
"sii_configuracion"	"clave_privada"	"text"
"sii_configuracion"	"fecha_creacion"	"timestamp without time zone"
"sii_configuracion"	"fecha_actualizacion"	"timestamp without time zone"
"sii_configuracion"	"activo"	"boolean"
"tipos_cuenta"	"id"	"integer"
"tipos_cuenta"	"codigo"	"character varying"
"tipos_cuenta"	"nombre"	"character varying"
"tipos_cuenta"	"naturaleza"	"character varying"
"tipos_cuenta"	"categoria"	"character varying"
"tipos_cuenta"	"descripcion"	"text"
"tipos_cuenta"	"activo"	"boolean"
"tipos_cuenta"	"created_at"	"timestamp without time zone"
"transacciones_contables"	"id"	"integer"
"transacciones_contables"	"factura_id"	"integer"
"transacciones_contables"	"tipo_transaccion"	"character varying"
"transacciones_contables"	"cuenta_contable"	"character varying"
"transacciones_contables"	"monto"	"numeric"
"transacciones_contables"	"moneda"	"character varying"
"transacciones_contables"	"fecha_registro"	"timestamp without time zone"
"transacciones_contables"	"descripcion"	"text"
"transacciones_contables"	"estado"	"character varying"
"usuarios"	"id"	"integer"
"usuarios"	"id_negocio"	"integer"
"usuarios"	"email"	"character varying"
"usuarios"	"password_hash"	"character varying"
"usuarios"	"rol"	"character varying"
"usuarios"	"created_at"	"timestamp without time zone"
"vista_balance_comprobacion"	"codigo"	"character varying"
"vista_balance_comprobacion"	"nombre"	"character varying"
"vista_balance_comprobacion"	"naturaleza"	"character varying"
"vista_balance_comprobacion"	"categoria"	"character varying"
"vista_balance_comprobacion"	"total_debe"	"numeric"
"vista_balance_comprobacion"	"total_haber"	"numeric"
"vista_balance_comprobacion"	"saldo_final"	"numeric"
"vista_balance_general"	"categoria"	"character varying"
"vista_balance_general"	"codigo"	"character varying"
"vista_balance_general"	"nombre"	"character varying"
"vista_balance_general"	"saldo"	"numeric"
"vista_estado_resultados"	"categoria"	"character varying"
"vista_estado_resultados"	"codigo"	"character varying"
"vista_estado_resultados"	"nombre"	"character varying"
"vista_estado_resultados"	"monto"	"numeric"
"vista_facturas_dte"	"id"	"integer"
"vista_facturas_dte"	"fecha_factura"	"date"
"vista_facturas_dte"	"serie"	"character varying"
"vista_facturas_dte"	"numero"	"character varying"
"vista_facturas_dte"	"ruc"	"character varying"
"vista_facturas_dte"	"proveedor"	"character varying"
"vista_facturas_dte"	"importe"	"numeric"
"vista_facturas_dte"	"moneda"	"character varying"
"vista_facturas_dte"	"estado_factura"	"character varying"
"vista_facturas_dte"	"dte_folio"	"character varying"
"vista_facturas_dte"	"dte_tipo"	"integer"
"vista_facturas_dte"	"dte_estado"	"character varying"
"vista_facturas_dte"	"dte_fecha_envio"	"timestamp without time zone"
"vista_facturas_dte"	"estado_sii"	"character varying"
"vista_facturas_dte"	"glosa_sii"	"text"
"vista_facturas_dte"	"track_id"	"character varying"
"vista_facturas_dte"	"fecha_respuesta_sii"	"timestamp without time zone"
"vista_facturas_dte"	"tipo_dte_desc"	"text"
"vista_facturas_dte"	"total_items"	"bigint"